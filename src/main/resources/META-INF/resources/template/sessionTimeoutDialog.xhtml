<!-- Define a facelet component for session timeout logic -->
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns="http://www.w3.org/1999/xhtml">

    <!-- Include the JavaScript file for countdown functionality -->
    <h:outputScript library="showcase" name="script/countdown.js" target="head"/>

    <!-- Form for the session timeout logic; only rendered if the user is logged in -->
    <h:form id="logoutDialogForm" rendered="#{securityService.isLoggedIn()}">

        <!-- Monitor user inactivity; triggers when the calculated timeout is reached -->
        <p:idleMonitor timeout="#{securityService.calculateIdleTimeWarningTime()}"
                       onidle="startCountdown(#{securityService.idleTimeoutWarning.toMillis()}, 'countdown', 'wgtSessionExpiration', '#{component.findComponent('logoutButton').getClientId()}')">

            <!-- Dialog that pops up to warn users about session expiration -->
            <p:confirmDialog header="Session Expiration Warning"
                             severity="alert"
                             widgetVar="wgtSessionExpiration"
                             closable="false"
                             showEffect="shake"
                             styleClass="border-solid border-2 border-red-500">

                <!-- Message displayed within the dialog -->
                <f:facet name="message">
                    Session will expire in <span id='countdown'
                                                 class="text-red-500"></span> <!-- Display countdown timer here -->
                </f:facet>

                <!-- Button to "ping" or refresh the user session -->
                <p:commandButton value="Refresh" action="#{securityService.ping}" id="refreshButton"
                                 oncomplete="stopCountdown('countdown', 'wgtSessionExpiration')"
                                 styleClass="bg-green-500"/>

                <!-- Logout button; hides the dialog and logs the user out -->
                <p:commandButton value="Logout" action="#{securityService.logout}" id="logoutButton"
                                 oncomplete="PF('wgtSessionExpiration').hide();" styleClass="bg-red-500"/>
            </p:confirmDialog>
        </p:idleMonitor>
    </h:form>
</ui:composition>